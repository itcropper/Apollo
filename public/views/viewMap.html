<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
      #map-canvas {height:50%; width:80%; margin: 0 auto;}
      video {margin: 0 auto; width: 400px; display:block;}
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDSjvm5zmxT5E8o0EYrz1xXSzYe1Bw2gu8">
    </script>
  </head>
  <body>
<div id="map-canvas"></div>
      <video width="320" height="240" controls>
  <source  type="video/mp4">
</video>
      
  </body>

<script src="/js/jquery.min.js"
        type="text/javascript"></script>
<script>


    $.ajax({
        url: "/api/v1.1.0/horns",
        method: "GET",
        data: ""
    }).done(function(res){
        
        function setMap(position) {
            var mapOptions = 
                {
                center: { 
                    lat: position.coords.latitude, 
                    lng: position.coords.longitude
                },
                zoom: 12
            }
            var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
            
            $.each(res, function(index, value){
                if(value.location && value.location.lat && value.location.lon){
                    var myLatlng = new google.maps.LatLng(value.location.lat,value.location.lon);
                    var marker = new google.maps.Marker({
                        position: myLatlng,
                        map: map,
                        link: value.path,
                        title: value.name,
                        url: "views/" + value._id
                    
                    });
                      google.maps.event.addListener(marker, 'click', function() {
                        setUrlClick(marker);
                      });
                }else{
                    return;
                }
            });
        }
        function initialize() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(setMap);
            } 
        }
        initialize();
        
        function setUrlClick(marker) {
            $('video source').attr('src', marker.link);
            $("video")[0].load();
            $('video')[0].play();
        }
            

    });
</script> 
</html>


